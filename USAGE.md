# 使用指南

## 这是什么

wuwenzixun 是一个企业风险分析工具。输入一个公司名称，它会自动从网上搜索该企业的新闻、风险事件、财务信息，然后生成一份综合分析报告和未来展望。

## 环境准备

运行前请确认系统已安装以下工具：

```bash
# 检查 bash 版本（需要 3.2+）
bash --version

# 检查 curl 是否可用
curl --version
```

macOS 和大多数 Linux 发行版已自带这两个工具，无需额外安装。

## 一键分析（最常用）

最简单的用法——输入公司名称，等待报告生成：

```bash
./analyze.sh "腾讯"
```

这条命令会依次执行 5 个步骤：

1. 搜索该企业的最新新闻
2. 检索诉讼、处罚、失信等风险信息
3. 抓取财报、营收、资产负债等财务数据
4. 汇总以上数据，生成风险分析报告
5. 基于分析结果，给出未来展望和行动建议

### 指定分析深度

```bash
# 快速概览（速度快，数据量少）
./analyze.sh "腾讯" --depth quick

# 标准分析（默认）
./analyze.sh "腾讯" --depth normal

# 深度分析（数据更全，耗时更长）
./analyze.sh "腾讯" --depth full
```

## 单独使用子模块

如果你只关心某一方面的信息，可以单独运行对应的模块，不必跑完整流程。

### 只看新闻

```bash
# 获取最新 10 条新闻（默认）
bash news/fetch.sh "腾讯"

# 指定获取 5 条
bash news/fetch.sh "腾讯" 5
```

### 只查风险

```bash
# 检索诉讼、处罚、失信、负面舆情
bash risk/check.sh "恒大"
```

### 只看财务

```bash
# 抓取财报、营收利润、资产负债、业绩动态
bash finance/fetch.sh "贵州茅台"
```

### 只生成报告

需要先运行上面的数据采集模块，报告模块会读取它们的缓存数据来生成报告：

```bash
# 先采集数据
bash news/fetch.sh "比亚迪"
bash risk/check.sh "比亚迪"
bash finance/fetch.sh "比亚迪"

# 再生成报告
bash report/generate.sh "比亚迪"
```

### 只看未来展望

```bash
bash outlook/predict.sh "宁德时代"
```

## 缓存机制

为了避免重复请求，每个模块的结果会自动缓存到 `~/.cache/wuwenzixun/` 目录下。再次查询同一家公司时，如果缓存未过期，会直接返回上次的结果。

各模块的缓存有效期：

| 模块 | 有效期 | 说明 |
|------|--------|------|
| 新闻 | 1 小时 | 新闻更新快，缓存时间短 |
| 风险 | 24 小时 | 风险信息变化较慢 |
| 财务 | 12 小时 | 财务数据按季度更新 |
| 报告 | 12 小时 | 跟随数据源更新 |
| 展望 | 24 小时 | 趋势判断不需要频繁刷新 |

如果想强制获取最新数据，删除缓存目录即可：

```bash
rm -rf ~/.cache/wuwenzixun/
```

## 自定义配置

所有配置集中在项目根目录的 `config.sh` 文件中，可以根据需要修改：

```bash
# 默认分析深度：quick | normal | full
ANALYSIS_DEPTH="normal"

# 日志级别：debug | info | warn | error
# 设为 debug 可以看到详细的请求过程
LOG_LEVEL="info"

# 网络请求超时（秒）
REQUEST_TIMEOUT=15

# 请求失败重试次数
REQUEST_RETRY=3
```

## 报告怎么看

完整分析会输出一份 Markdown 格式的报告，主要包含以下部分：

```
# XX公司 风险分析报告

## 执行摘要          ← 一句话概括，数据覆盖范围
## 新闻舆情分析      ← 近期新闻标题列表
## 风险事件分析      ← 诉讼、处罚、失信、负面舆情
## 财务分析          ← 财报、营收利润、资产负债、业绩动态
## 综合评估          ← 五维度风险权重表
## 结论与建议        ← 后续行动建议
```

展望报告则分为短期（1-3 个月）、中期（3-12 个月）、长期（1-3 年）三个时间维度，并附带行动建议。

## 常见问题

**运行后显示"未获取到相关新闻"或数据为空？**

这通常是因为搜索引擎对自动化请求做了限制（返回验证码页面）。可以尝试：
- 过一段时间再运行
- 删除缓存后重试：`rm -rf ~/.cache/wuwenzixun/`
- 将 `config.sh` 中的 `LOG_LEVEL` 改为 `debug` 查看详细请求日志

**报告模块显示"暂无数据，请先运行 xxx"？**

报告和展望模块依赖前面三个数据采集模块的缓存结果。如果单独运行 `report/generate.sh`，需要先运行 `news/fetch.sh`、`risk/check.sh`、`finance/fetch.sh`。使用 `./analyze.sh` 则会自动按顺序执行，无需手动操心。

**如何将报告保存到文件？**

所有输出都是标准输出，用重定向即可：

```bash
./analyze.sh "腾讯" > 腾讯分析报告.md 2>/dev/null
```

**公司名称应该怎么填？**

填企业的常用简称即可，比如"腾讯"、"阿里巴巴"、"比亚迪"。名称越准确，搜索结果越相关。
